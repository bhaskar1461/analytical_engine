# Architecture

## Stack

- Frontend: Next.js 15 + TypeScript + Tailwind + Framer Motion
- API Gateway: Fastify + Zod + Supabase + cache layer
- Intelligence: FastAPI + deterministic scoring engines
- Data: Supabase Postgres
- Cache: Upstash Redis (REST API) with in-memory fallback
- Deploy: Railway (web + api + intelligence), GitHub Actions (CI + scheduled jobs)
- Observability: optional Sentry + PostHog telemetry on API and intelligence service

## Request Flow

1. Client requests stock intelligence from API gateway.
2. Gateway validates input, applies auth/rate limits, checks cache.
3. On misses, gateway calls intelligence service.
4. Gateway merges DB/news/social records and returns compliant payload.
5. Frontend renders result with stale-data and disclaimer surfaces.
6. API/intelligence emit latency and error telemetry events when configured.

## Intelligence Flow

1. Market/news/social provider data fetched with deterministic fallbacks.
2. Trust score uses fixed weighted formula and daily delta cap.
3. Hype spike and low-confidence dampeners are applied.
4. Portfolio and SIP are generated by rule-based deterministic allocators.
5. Outputs include confidence and warning metadata.

## Safety Rules

- No direct advisory language.
- No guaranteed returns.
- No black-box or random trust scoring.
- Social influence constrained with hype penalties and upper score cap.
- Missing history (<2 years) triggers confidence and score dampening.

## Data Ownership

- `trust_scores` and `social_daily` are produced by batch jobs.
- `news_items` and `social_posts` are ingestion outputs.
- `quiz_results`, `portfolios`, `sip_plans`, `donations` are user-event tables.
- `audit_events` stores traceability for model versions and anomalies.
